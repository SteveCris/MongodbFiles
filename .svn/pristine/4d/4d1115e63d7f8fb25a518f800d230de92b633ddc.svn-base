package com.shangyong.thzlqb;

import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

import org.apache.commons.lang3.RandomUtils;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import com.fasterxml.jackson.databind.node.ObjectNode;
import com.shangyong.thzlqb.contants.CoreContants;
import com.shangyong.thzlqb.service.MongodbService;
import com.shangyong.thzlqb.service.PushService;
import com.shangyong.thzlqb.service.PushTwoService;

@RunWith(SpringRunner.class)
@SpringBootTest
public class PushTest {

	private static Logger logger = LoggerFactory.getLogger(PushTest.class);

	@Autowired
	private PushService pushService;

	@Autowired
	private PushTwoService pushTwoService;

	@Autowired
	private MongodbService mongodbService;

	private CountDownLatch countDownLatch = new CountDownLatch(1);

	@Test
	public void test() {
		//1764387,
		String str1 = "1763928,1757070,1755583,1755113,1754943,1751908,1751856,1751618,1750120,1749650,1749241,1749165,1748820,1748676,1748364,1748290,1747508,1747214,1746681,1746015,1745190,1743126,1743112,1742960,1742958,1742922,1742308,1741208,1741203,1741199,1741188,1741180,1741184,1741162,1741157,1741148,1741147,1741145,1741146,1741136,1741130,1741123,1741108,1741093,1741084,1741083,1741077,1741071,1741069";
		String str2 = "1741064,1741060,1741054,1741052,1741046,1741040,1741035,1741034,1741014,1741011,1741008,1741003,1741002,1740987,1740981,1740979,1738573,1738482,1736213,1736204,1736219,1736214,1736203,1736206,1736208,1736197,1736186,1736192,1736179,1736159,1736146,1736178,1736163,1736189,1736180,1736162,1736135,1736160,1736182,1736164,1736143,1736154,1736125,1736149,1736138,1736148,1736120,1736147,1736141,1736118";
		String str="1734980,1734972,1734970,1734958,1734952,1734955,1734953,1734948,1734943,1734941,1734937,1734928,1734929,1734927,1734920,1734917,1734913,1734912,1734906,1734902,1734905,1734904,1734903,1734901,1734900,1734898,1734897,1734892,1734883,1734884,1734882,1734575,1734573,1734569,1734563,1734562,1734557,1734555,1734554,1734552,1734551,1734550,1734535,1734531,1734530,1734529,1734518,1734517,1734516,1734515,1734512,1734510,1734509,1734506,1734505,1734501,1734499,1734498,1734497,1734496,1734495,1734493,1734492,1734490,1734489,1734487,1734485,1734484,1734483,1734482,1734481,1734480,1734478,1734476,1734475,1734470,1734471,1734469,1734468,1734465,1734464,1734461,1734460,1734459,1734458,1734457,1734454,1734450,1734447,1734445,1734181,1734162,1734210,1734235,1734271,1734240,1734221,1734265,1734245,1734276,1734273,1734270,1734268,1734264,1734261,1734258,1734250,1734244,1734243,1734242,1734238,1734232,1734231,1734228,1734223,1734222,1734209,1734205,1734202,1734201,1734200,1734199,1734197,1734190,1734187";
		//1734186,
		String ss="1734183,1734174,1734172,1734169,1734164,1734157,1734156,1734155,1734153,1734152,1734136,1734013,1733909,1733865,1733829,1733793,1733218,1733172"
				+",1741048,1764307";
		sssss(ss);

		try {
			countDownLatch.await();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
	}

	private void sssss(String str) {
		// String str = "1764387";
		String[] orderNos = str.split(",");
		int count = 0;
		for (String orderNo : orderNos) {

			ObjectNode node = mongodbService.getData(CoreContants.PUSH_COLLECTION, orderNo);

			boolean pone = pushService.pushOne(orderNo, node);
			logger.info("count {}", ++count);
			logger.info("一推订单号：{}，result：{}", orderNo, pone);
			boolean ptwo = pone && pushTwoService.pushTwo(orderNo, node);
			logger.info("二推订单号：{}，result：{}", orderNo, ptwo);

		}

	}

}
